---
title: uni-app v3 开发指南
category:
  - 跨平台框架
tag:
  - uni-app
  - v3
order: 3
---

# uni-app v3 开发指南

## 目录

1. [概述](#概述)
2. [Vue 3 与 Vue 2 的区别](#vue-3-与-vue-2-的区别)
3. [Vue 3 新功能特性](#vue-3-新功能特性)
4. [响应式数据操作最佳实践](#响应式数据操作最佳实践)
5. [小程序平台限制](#小程序平台限制)
6. [环境变量配置](#环境变量配置)
7. [参考资源](#参考资源)

## 概述

uni-app v3 是基于 Vue 3 构建的跨平台应用开发框架，支持一套代码多端运行。本指南涵盖了从基础概念到实际开发的全面内容。

**官方文档链接：**
- [Vue 3 官网](https://cn.vuejs.org/guide)
- [uni-app v3 官网](https://uniapp.dcloud.net.cn/tutorial/vue3-basics.html)
- [Pinia 状态管理](https://pinia.vuejs.org/zh/ssr/)

## Vue 3 与 Vue 2 的区别

### 核心变化
- **组合式 API (Composition API)**：提供了更灵活的逻辑组织方式
- **响应式系统重构**：性能更优，支持更复杂的响应式场景
- **TypeScript 支持增强**：原生支持，类型推断更准确
- **Tree Shaking 优化**：打包体积更小
- **片段支持**：组件可以有多个根节点

## Vue 3 新功能特性

### 1. 响应式 API

#### ref() 和 reactive()

```javascript
import { ref, reactive } from 'vue'

// ref 用于基本类型和单值
const count = ref(0)
const name = ref('张三')

// reactive 用于对象和数组
const user = reactive({
  id: 1,
  name: '李四',
  age: 25
})

const list = reactive([1, 2, 3])
```

**使用原则：**
- `ref`：适用于基本数据类型（string, number, boolean）
- `reactive`：适用于对象和数组

#### toValue() 函数

```javascript
import { toValue, ref, computed } from 'vue'

const count = ref(10)
const doubled = computed(() => count.value * 2)

console.log(toValue(count))   // 10
console.log(toValue(doubled)) // 20
console.log(toValue(5))       // 5
```

### 2. 组合式函数 (Composables)

```javascript
// useCounter.js
import { ref } from 'vue'

export function useCounter(initialValue = 0) {
  const count = ref(initialValue)
  
  const increment = () => count.value++
  const decrement = () => count.value--
  const reset = () => count.value = initialValue
  
  return {
    count,
    increment,
    decrement,
    reset
  }
}

// 在组件中使用
import { useCounter } from './useCounter.js'

export default {
  setup() {
    const { count, increment, decrement } = useCounter(10)
    
    return {
      count,
      increment,
      decrement
    }
  }
}
```

### 3. setup 语法糖

```vue
<script setup lang="ts">
import { ref, reactive, computed } from 'vue'

// 直接声明响应式数据
const count = ref(0)
const user = reactive({
  name: '张三',
  age: 20
})

// 计算属性
const doubleCount = computed(() => count.value * 2)

// 方法
const handleClick = () => {
  count.value++
}
</script>

<template>
  <div>
    <p>计数: {{ count }}</p>
    <p>双倍: {{ doubleCount }}</p>
    <button @click="handleClick">增加</button>
  </div>
</template>
```

### 4. 内置组件

#### Teleport 传送组件

```vue
<template>
  <!-- 将模态框传送到 body 下 -->
  <Teleport to="body">
    <div class="modal" v-if="showModal">
      <p>这是一个模态框</p>
    </div>
  </Teleport>
</template>
```

#### Suspense 异步组件

```vue
<template>
  <Suspense>
    <!-- 异步组件 -->
    <AsyncComponent />
    
    <!-- 加载中的回退内容 -->
    <template #fallback>
      <div>加载中...</div>
    </template>
  </Suspense>
</template>
```

### 5. Pinia 状态管理

```javascript
// stores/user.js
import { defineStore } from 'pinia'

export const useUserStore = defineStore('user', {
  state: () => ({
    name: '',
    age: 0,
    email: ''
  }),
  
  getters: {
    fullInfo: (state) => `${state.name} (${state.age}岁)`
  },
  
  actions: {
    updateUser(userData) {
      this.name = userData.name
      this.age = userData.age
      this.email = userData.email
    }
  }
})
```

### 6. 样式变化

#### 深度选择器更新

```vue
<style scoped>
/* Vue 3 推荐写法 */
:deep(.el-form-item__label) {
  font-size: 15px;
  color: rgb(22, 22, 22);
}

:deep(.el-form-item) {
  margin-bottom: 0;
}

/* Vue 2 旧写法（已废弃） */
/* ::v-deep .el-form-item__label { } */
/* /deep/ .el-form-item__label { } */
</style>
```

### 7. 生产提示配置移除

Vue 3 中不再需要手动设置 `Vue.config.productionTip = false`，框架已自动优化。

## 响应式数据操作最佳实践

### 1. 数组操作保持响应性

```javascript
import { reactive } from 'vue'

const historyData = reactive([])

// ✅ 推荐：使用 splice 清空并替换数组
const updateArray = (newData) => {
  historyData.splice(0, historyData.length, ...newData)
}

// ✅ 推荐：使用数组方法
historyData.push(newItem)
historyData.pop()
historyData.shift()
historyData.unshift(newItem)

// ❌ 不推荐：直接赋值会破坏响应性
// historyData = newData
```

### 2. 对象属性更新

```javascript
import { reactive } from 'vue'

const user = reactive({
  name: 'John',
  age: 30,
  profile: {
    email: '',
    phone: ''
  }
})

// ✅ 推荐：直接修改属性
user.name = 'Jane'
user.age = 25

// ✅ 推荐：使用 Object.assign 批量更新
Object.assign(user, {
  name: 'Bob',
  age: 35
})

// ✅ 推荐：更新嵌套对象
Object.assign(user.profile, {
  email: 'bob@example.com',
  phone: '123456789'
})
```

### 3. 完整示例

```vue
<script setup lang="ts">
import { reactive, ref } from 'vue'

// 响应式数据定义
const listData = reactive<any[]>([])
const historyData = reactive<any[]>([])
const queryData = reactive({
  keyword: '',
  page: 1,
  size: 10
})

// 数据操作方法
const updateListData = (newData: any[]) => {
  listData.splice(0, listData.length, ...newData)
}

const clearHistoryData = () => {
  historyData.splice(0, historyData.length)
}

const updateQueryData = (newQuery: Partial<typeof queryData>) => {
  Object.assign(queryData, newQuery)
}

// 数据初始化
const initData = async () => {
  try {
    const response = await fetch('/api/data')
    const data = await response.json()
    
    updateListData(data.list)
    updateQueryData({ keyword: data.keyword })
  } catch (error) {
    console.error('数据加载失败:', error)
  }
}

// 组件挂载时初始化数据
import { onMounted } from 'vue'
onMounted(() => {
  initData()
})
</script>

<template>
  <div class="container">
    <!-- 搜索区域 -->
    <div class="search-box">
      <input 
        v-model="queryData.keyword" 
        placeholder="请输入搜索关键词"
      >
      <button @click="initData">搜索</button>
    </div>
    
    <!-- 列表数据 -->
    <div class="list-section">
      <h3>数据列表:</h3>
      <ul v-if="listData.length">
        <li v-for="item in listData" :key="item.id">
          {{ item.name }}
        </li>
      </ul>
      <p v-else>暂无数据</p>
    </div>
    
    <!-- 历史记录 -->
    <div class="history-section">
      <h3>历史记录:</h3>
      <button @click="clearHistoryData">清空历史</button>
      <ul v-if="historyData.length">
        <li v-for="item in historyData" :key="item.id">
          {{ item.name }}
        </li>
      </ul>
      <p v-else>暂无历史记录</p>
    </div>
  </div>
</template>
```

## 小程序平台限制

uni-app v3 在小程序平台有以下功能限制：

| 功能类别 | 限制说明 |
|---------|---------|
| **应用配置** | `performance` 只在Web环境下支持 |
| **应用API** | `directive` 不支持 |
| **全局API** | 除了`createApp`都不支持 |
| **DOM操作** | 完全不支持 |
| **生命周期钩子** | `activated`、`deactivated`不支持 |
| **选项/资源** | `directives`不支持 |
| **选项/杂项** | `delimiters`、`inheritAttrs`不支持 |
| **实例属性** | `$el`、`$attrs`不支持 |
| **指令** | `v-text`、`v-pre`、`v-cloak`、`v-once`、`v-is`不支持 |
| **特殊属性** | `is`不支持 |
| **内置组件** | 除了`slot`全部都不支持 |

> **详细说明：** [uni-app v3 API支持情况](https://uniapp.dcloud.net.cn/tutorial/vue3-api.html)

## 环境变量配置

### 脚手架工具说明

uni-app 支持两种脚手架工具：

1. **uni CLI**
   - 面向非HBuilderX用户（如VSCode/WebStorm开发者）
   - 提供项目创建、编译发行功能
   - App平台仅支持离线打包，不支持云端打包

2. **HBuilderX CLI**
   - 面向HBuilderX用户的自动化工具
   - 支持完整的打包和部署功能
   - 不支持Linux平台

### Vue CLI + Vite 环境变量配置

#### 1. 配置文件结构

```
project-root/
├── .env                    # 所有环境默认变量
├── .env.local             # 本地环境变量（被git忽略）
├── .env.development       # 开发环境变量
├── .env.production        # 生产环境变量
├── .env.test              # 测试环境变量
├── .env.staging           # 预发布环境变量
└── package.json
```

#### 2. 配置文件优先级

```
.env < .env.local < .env.[mode] < .env.[mode].local
```

#### 3. 环境变量命名规则

```bash
# .env.development
VITE_API_BASE_URL=https://dev-api.example.com
VITE_APP_TITLE=开发环境
VITE_ENABLE_DEBUG=true

# ❌ 错误：不以 VITE_ 开头的变量无法在客户端访问
DB_PASSWORD=secret123
```

#### 4. 使用环境变量

```javascript
// 在代码中使用
console.log(import.meta.env.VITE_API_BASE_URL)  // ✅ 可访问
console.log(import.meta.env.VITE_APP_TITLE)     // ✅ 可访问
console.log(import.meta.env.DB_PASSWORD)        // ❌ undefined

// 环境判断
if (import.meta.env.DEV) {
  console.log('开发环境')
}

if (import.meta.env.PROD) {
  console.log('生产环境')
}
```

#### 5. 自定义运行脚本

```json
{
  "scripts": {
    "dev:h5": "uni",
    "dev:h5:test": "uni --mode test",
    "dev:h5:staging": "uni --mode staging",
    "dev:mp-weixin": "uni -p mp-weixin",
    "dev:mp-weixin:test": "uni -p mp-weixin --mode test",
    "build:h5": "uni build",
    "build:h5:test": "uni build --mode test"
  }
}
```

#### 6. 实际配置示例

**.env（基础配置）**
```bash
VITE_APP_NAME=我的应用
VITE_APP_VERSION=1.0.0
```

**.env.development（开发环境）**
```bash
VITE_API_BASE_URL=https://dev-api.example.com
VITE_ENABLE_MOCK=true
VITE_LOG_LEVEL=debug
```

**.env.production（生产环境）**
```bash
VITE_API_BASE_URL=https://api.example.com
VITE_ENABLE_MOCK=false
VITE_LOG_LEVEL=error
```

**.env.test（测试环境）**
```bash
VITE_API_BASE_URL=https://test-api.example.com
VITE_ENABLE_MOCK=false
VITE_LOG_LEVEL=warn
```

### HBuilderX 环境变量配置

#### package.json 配置示例

```json
{
  "name": "my-uni-app",
  "version": "1.0.0",
  "uni-app": {
    "scripts": {
      "dev-test": {
        "title": "开发环境-测试",
        "browser": "chrome",
        "env": {
          "UNI_PLATFORM": "h5",
          "NODE_ENV": "development",
          "VUE_APP_API_URL": "https://dev-api.example.com",
          "VUE_APP_TITLE": "测试环境"
        },
        "define": {
          "CUSTOM_DEBUG": true
        }
      },
      "build-staging": {
        "title": "预发布环境",
        "env": {
          "UNI_PLATFORM": "h5",
          "NODE_ENV": "production",
          "VUE_APP_API_URL": "https://staging-api.example.com",
          "VUE_APP_TITLE": "预发布环境"
        },
        "define": {
          "CUSTOM_DEBUG": false
        }
      }
    }
  }
}
```

#### 在代码中使用

```javascript
// 获取环境变量
const apiUrl = process.env.VUE_APP_API_URL
const appTitle = process.env.VUE_APP_TITLE

// 条件编译
// #ifdef CUSTOM_DEBUG
console.log('调试模式开启')
// #endif

// 平台判断
// #ifdef H5
console.log('H5平台')
// #endif

// #ifdef MP-WEIXIN
console.log('微信小程序平台')
// #endif
```

参考: [uni-app 基于 HBuilderX 多环境变量配置完整指南](./hbuildx-env.md)

### 环境配置最佳实践

#### 1. 统一管理配置

```javascript
// config/index.js
const config = {
  development: {
    baseURL: import.meta.env.VITE_API_BASE_URL,
    timeout: 10000,
    enableMock: import.meta.env.VITE_ENABLE_MOCK === 'true'
  },
  production: {
    baseURL: import.meta.env.VITE_API_BASE_URL,
    timeout: 5000,
    enableMock: false
  }
}

export default config[import.meta.env.MODE] || config.production
```

#### 2. 类型定义（TypeScript）

```typescript
// types/env.d.ts
interface ImportMetaEnv {
  readonly VITE_API_BASE_URL: string
  readonly VITE_APP_TITLE: string
  readonly VITE_ENABLE_DEBUG: string
  readonly VITE_LOG_LEVEL: 'debug' | 'info' | 'warn' | 'error'
}

interface ImportMeta {
  readonly env: ImportMetaEnv
}
```

#### 3. 环境检测工具函数

```javascript
// utils/env.js
export const isDev = import.meta.env.DEV
export const isProd = import.meta.env.PROD
export const isTest = import.meta.env.MODE === 'test'

export const getEnvConfig = (key, defaultValue = '') => {
  return import.meta.env[key] || defaultValue
}

export const isDebugEnabled = () => {
  return getEnvConfig('VITE_ENABLE_DEBUG') === 'true'
}
```

## 参考资源

### 官方文档
- [Vue 3 官方指南](https://cn.vuejs.org/guide)
- [uni-app v3 文档](https://uniapp.dcloud.net.cn/tutorial/vue3-basics.html)
- [Pinia 状态管理](https://pinia.vuejs.org/zh/)
- [Vite 环境变量](https://vitejs.dev/guide/env-and-mode.html)

### 开发工具
- [HBuilderX](https://www.dcloud.io/hbuilderx.html) - DCloud 官方IDE
- [uni-app CLI](https://uniapp.dcloud.net.cn/quickstart-cli.html) - 命令行工具
- [Vue DevTools](https://devtools.vuejs.org/) - Vue 调试工具

### 社区资源
- [uni-app 插件市场](https://ext.dcloud.net.cn/)
- [Vue 3 生态系统](https://github.com/vuejs/awesome-vue)
- [DCloud 社区](https://ask.dcloud.net.cn/)

---

*本指南将持续更新，如有问题或建议，请参考官方文档或社区讨论。*